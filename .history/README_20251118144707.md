
# FlashNotify - D√©ploiement

Ce document d√©crit les diff√©rentes m√©thodes de d√©ploiement de l'application FlashNotify.

## Architecture

FlashNotify est une application Python qui combine Flask et FastAPI :

- **Flask** : Interface web traditionnelle (port 5000)
- **FastAPI** : API moderne (port 8000)
- **Base de donn√©es** : PostgreSQL ou SQLite
- **File d'attente** : Redis
- **Proxy inverse** : Nginx

## M√©thodes de d√©ploiement

### 1. Docker (Recommand√©)

#### Pr√©requis
- Docker
- Docker Compose

#### D√©ploiement avec Docker Compose

```bash
# Lancer l'application compl√®te
docker-compose up -d

# Arr√™ter l'application
docker-compose down

# Voir les logs
docker-compose logs -f
```

#### D√©ploiement avec le script de d√©ploiement

```bash
# D√©ploiement en d√©veloppement (par d√©faut)
./deploy.sh

# D√©ploiement en staging
./deploy.sh staging

# D√©ploiement en production
./deploy.sh prod

# Reconstruction de l'image
./deploy.sh dev -r
```

### 2. D√©ploiement manuel

#### Pr√©requis
- Python 3.11+
- PostgreSQL
- Redis

#### Installation

```bash
# Installation des d√©pendances
pip install -r requirements.txt

# Initialisation de la base de donn√©es
python -c "from app import init_db; init_db()"

# Lancement de l'API FastAPI
python run_fastapi.py

# Lancement de l'application Flask
python app.py
```

## Configuration

### Variables d'environnement

| Variable | Description | Valeur par d√©faut |
|----------|-------------|-------------------|
| `DATABASE_URL` | URL de la base de donn√©es | `sqlite:///./flashnotify.db` |
| `REDIS_URL` | URL de Redis | `redis://localhost:6379/0` |
| `SESSION_SECRET` | Cl√© secr√®te pour les sessions | `dev-secret-key-change-in-production` |
| `FASTAPI_PORT` | Port pour l'API FastAPI | `8000` |
| `FLASK_PORT` | Port pour l'application Flask | `5000` |
| `ENVIRONMENT` | Environnement (dev/staging/prod) | `dev` |

### Fichiers d'environnement

Vous pouvez cr√©er des fichiers `.env.dev`, `.env.staging`, `.env.prod` pour chaque environnement.

## Mise √† jour

### Mise √† jour avec Docker

```bash
# R√©cup√©rer les derni√®res modifications
git pull

# Reconstruire l'image et red√©marrer
docker-compose up -d --build
```

### Mise √† jour manuelle

```bash
# R√©cup√©rer les derni√®res modifications
git pull

# Mettre √† jour les d√©pendances
pip install -r requirements.txt

# Red√©marrer l'application
```

## Surveillance

### Acc√®s aux logs

Avec Docker Compose :
```bash
docker-compose logs -f app
docker-compose logs -f db
docker-compose logs -f redis
```

### Points d'extr√©mit√© de surveillance

- `/api/v2/health/` : V√©rification de sant√© de l'API
- `/docs` : Documentation interactive de l'API
- `/redoc` : Documentation alternative de l'API

## S√©curit√©

- Le script de d√©ploiement cr√©e un utilisateur non root dans le conteneur
- Les mots de passe et cl√©s secr√®tes doivent √™tre configur√©s via des variables d'environnement
- Gestion des priorit√©s et des retries
- Surveillance et logging avanc√©

### 3. API Modernes avec FastAPI
**Fichier : `api/main.py`**

- Routes compl√®tes pour utilisateurs, notifications et statistiques
- Authentification par token JWT, API Key et sessions
- Validation Pydantic pour toutes les entr√©es
- Documentation automatique OpenAPI/Swagger

## üèóÔ∏è Architecture du Projet

```
.
‚îú‚îÄ‚îÄ app.py                          # Application Flask principale
‚îú‚îÄ‚îÄ run_fastapi.py                  # Script de lancement FastAPI
‚îú‚îÄ‚îÄ models.py                       # Mod√®les de base de donn√©es SQLAlchemy
‚îú‚îÄ‚îÄ requirements.txt                # D√©pendances Python
‚îú‚îÄ‚îÄ core/                           # Module des concepts POO avanc√©s
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py              # D√©corateurs de classes
‚îÇ   ‚îú‚îÄ‚îÄ descriptors.py             # Descripteurs de validation
‚îÇ   ‚îú‚îÄ‚îÄ metaclasses.py             # M√©taclasses pour g√©n√©ration de code
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                    # Syst√®me d'authentification
‚îÇ   ‚îú‚îÄ‚îÄ queue.py                   # Syst√®me de files d'attente
‚îÇ   ‚îî‚îÄ‚îÄ notification_system.py     # Syst√®me de notification avec mixins
‚îú‚îÄ‚îÄ api/                            # API FastAPI
‚îÇ   ‚îî‚îÄ‚îÄ main.py                    # Application FastAPI principale
‚îú‚îÄ‚îÄ templates/                      # Templates HTML Jinja2
‚îÇ   ‚îú‚îÄ‚îÄ base.html                  # Template de base
‚îÇ   ‚îú‚îÄ‚îÄ index.html                 # Page d'envoi de notifications
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html             # Dashboard des notifications
‚îÇ   ‚îî‚îÄ‚îÄ admin.html                 # Administration des utilisateurs
‚îî‚îÄ‚îÄ static/
    ‚îî‚îÄ‚îÄ css/
        ‚îî‚îÄ‚îÄ style.css              # Styles CSS personnalis√©s
```

## üîß Fonctionnalit√©s

### 1. Syst√®me de Notification Multi-Canal

- **Email** : Simulation d'envoi d'emails
- **SMS** : Simulation d'envoi de SMS
- **Push** : Simulation de notifications push

### 2. Gestion des Priorit√©s

Les priorit√©s sont d√©termin√©es automatiquement selon le type d'urgence :

- **CRITICAL** : S√©curit√©, Sant√© ‚Üí Envoi sur tous les canaux
- **HIGH** : M√©t√©o ‚Üí Envoi selon pr√©f√©rences utilisateur
- **MEDIUM** : Infrastructure ‚Üí Envoi selon pr√©f√©rences utilisateur
- **LOW** : Acad√©mique ‚Üí Envoi selon pr√©f√©rences utilisateur

### 3. Types d'Urgences

- üå©Ô∏è **M√©t√©o** : Alertes m√©t√©orologiques
- üö® **S√©curit√©** : Alertes de s√©curit√© critiques
- üè• **Sant√©** : Alertes sanitaires
- üîß **Infrastructure** : Probl√®mes d'infrastructure
- üìö **Acad√©mique** : Notifications acad√©miques

### 4. Interface Web

- **Page d'envoi** : Formulaire pour envoyer des notifications
- **Dashboard** : Visualisation des notifications avec statistiques et filtres
- **Administration** : Gestion des utilisateurs avec validation automatique

### 5. API RESTful avec FastAPI

- Endpoints pour la gestion des utilisateurs
- Endpoints pour l'envoi et la gestion des notifications
- Endpoints pour les statistiques et m√©triques
- Documentation interactive Swagger UI

## üöÄ Installation et Utilisation

### Pr√©requis

- Python 3.11
- PostgreSQL ou SQLite
- Variables d'environnement configur√©es

### Installation

```bash
# Cloner le projet
git clone https://github.com/your-org/flashnotify.git
cd flashnotify

# Cr√©er un environnement virtuel
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate  # Windows

# Installer les d√©pendances
pip install -r requirements.txt
```

### Configuration

Cr√©er un fichier `.env` avec les variables suivantes :
```env
# Flask
FLASK_APP=app.py
FLASK_ENV=development

# FastAPI
FASTAPI_HOST=0.0.0.0
FASTAPI_PORT=8000

# Database
DATABASE_URL=sqlite:///notifications.db

# Authentification
SESSION_SECRET=votre_cle_secrete
JWT_SECRET=votre_jwt_secret

# Redis (pour les files d'attente)
REDIS_URL=redis://localhost:6379/0
```

### D√©marrage

Lancer l'application Flask (interface web) :
```bash
python app.py
```

Lancer l'API FastAPI :
```bash
python run_fastapi.py
# ou
uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
```

L'application initialise automatiquement :
- La base de donn√©es
- Les tables (users, notifications, performance_metrics)
- 3 utilisateurs de test :
  - Alice Martin (alice.martin@universite.edu) - Pr√©f√®re Email
  - Bob Dupont (bob.dupont@universite.edu) - Pr√©f√®re Push
  - Charlie Bernard (charlie.bernard@universite.edu) - Pr√©f√®re Email

### Utilisation

1. **Envoyer une notification via l'interface web** : 
   - Aller sur la page d'accueil
   - S√©lectionner un utilisateur
   - Choisir le type d'urgence (la priorit√© est automatique)
   - Remplir le titre et le message
   - Cliquer sur "Envoyer la Notification"

2. **Utiliser l'API FastAPI** :
   - Acc√©der √† http://localhost:8000/docs pour la documentation interactive
   - Utiliser les endpoints pour g√©rer les notifications par programme
   - Authentification requise pour la plupart des endpoints

3. **Voir le dashboard** :
   - Cliquer sur "Dashboard" dans la navigation
   - Voir les statistiques globales
   - Filtrer par type ou priorit√©
   - Consulter l'historique complet

4. **G√©rer les utilisateurs** :
   - Cliquer sur "Admin" dans la navigation
   - Ajouter un utilisateur (validation automatique email/t√©l√©phone)
   - Voir la liste des utilisateurs
   - Supprimer un utilisateur

## üìä Base de Donn√©es

### Mod√®le User
```python
- id: Integer (cl√© primaire)
- name: String(100)
- email: String(120) - Valid√© par EmailDescriptor
- phone: String(20) - Valid√© par PhoneDescriptor
- prefers_email: Boolean - Pr√©f√©rence de canal
- created_at: DateTime
```

### Mod√®le Notification
```python
- id: Integer (cl√© primaire)
- user_id: Integer (cl√© √©trang√®re)
- title: String(200)
- body: Text
- emergency_type: String(50)
- priority: String(20) - Valid√© par PriorityDescriptor
- channels: String(200) - Canaux utilis√©s
- status: String(20)
- created_at: DateTime
```

### Mod√®le PerformanceMetric
```python
- id: Integer (cl√© primaire)
- method_name: String(100)
- duration: Float - Dur√©e en secondes
- timestamp: DateTime
```

## üé® Design Patterns Utilis√©s

1. **Mixin Pattern** : SMSMixin, EmailMixin, PushNotificationMixin
2. **Decorator Pattern** : D√©corateurs de fonctions et de classes
3. **Registry Pattern** : NotificationRegistry pour enregistrer les notificateurs
4. **Circuit Breaker Pattern** : Gestion automatique des pannes
5. **Template Method Pattern** : Templates HTML avec Jinja2
6. **Singleton Pattern** : ConfigMeta
7. **Observer Pattern** : Syst√®me de notifications

## üîç Validation des Donn√©es

La validation est effectu√©e √† plusieurs niveaux :

1. **Au niveau du formulaire** : Validation HTML5 c√¥t√© client
2. **Au niveau des descripteurs** : Validation automatique lors de l'affectation
3. **Au niveau de la base de donn√©es** : Contraintes NOT NULL et UNIQUE
4. **Au niveau de l'API** : Validation Pydantic pour FastAPI

### Exemples de validation

**Email valide** : `etudiant@universite.edu` ‚úÖ  
**Email invalide** : `etudiant.com` ‚ùå

**T√©l√©phone valide** : `+33612345678` ‚úÖ  
**T√©l√©phone invalide** : `123456` ‚ùå

**Priorit√© valide** : `CRITICAL`, `HIGH`, `MEDIUM`, `LOW` ‚úÖ  
**Priorit√© invalide** : `SUPER_HIGH` ‚ùå

**Plage horaire valide** : `{'start': '09:00', 'end': '17:00'}` ‚úÖ
**Plage horaire invalide** : `{'start': '25:00', 'end': '17:00'}` ‚ùå

## üß™ Tests et D√©monstration

### Tester l'envoi de notifications

1. Envoyez une notification de type "S√©curit√©" ‚Üí Observez l'envoi sur tous les canaux (CRITICAL)
2. Envoyez une notification de type "Acad√©mique" ‚Üí Observez l'envoi selon les pr√©f√©rences (LOW)
3. Consultez le dashboard pour voir les statistiques mises √† jour

### Tester la validation

1. Essayez d'ajouter un utilisateur avec un email invalide ‚Üí Erreur de validation
2. Essayez d'ajouter un utilisateur avec un t√©l√©phone invalide ‚Üí Erreur de validation
3. Les descripteurs prot√®gent l'int√©grit√© des donn√©es

### Tester le Circuit Breaker

Le syst√®me simule al√©atoirement des √©checs d'envoi (10% de chance). Si trop d'√©checs se produisent, le circuit s'ouvre automatiquement pour prot√©ger le syst√®me.

### Tester l'API FastAPI

1. Acc√©der √† http://localhost:8000/docs
2. Tester les endpoints avec la documentation interactive
3. Authentifier avec un token JWT ou une API Key
4. Envoyer des notifications via l'API

## üìö Justification des Choix Techniques

### Pourquoi les D√©corateurs de Classes ?

- **R√©utilisabilit√©** : Ajout de fonctionnalit√©s sans modifier les classes
- **S√©paration des pr√©occupations** : Code m√©tier s√©par√© du code transversal
- **Maintenabilit√©** : Facile d'ajouter/retirer des fonctionnalit√©s

### Pourquoi les Descripteurs ?

- **Validation centralis√©e** : Une seule impl√©mentation pour tous les usages
- **R√©utilisabilit√©** : M√™mes descripteurs pour plusieurs classes
- **Encapsulation** : Logique de validation cach√©e dans le descripteur

### Pourquoi les M√©taclasses ?

- **G√©n√©ration de code** : Cr√©ation automatique de m√©thodes r√©p√©titives
- **Convention over Configuration** : Comportement automatique bas√© sur les conventions
- **DRY (Don't Repeat Yourself)** : √âvite la duplication de code

### Pourquoi Flask et FastAPI ?

- **Flask** : Simplicit√© et flexibilit√© pour l'interface web
- **FastAPI** : Performance et documentation automatique pour l'API
- **Compl√©mentarit√©** : Interface utilisateur avec Flask, API moderne avec FastAPI

### Pourquoi les files d'attente ?

- **Performance** : Traitement asynchrone des notifications
- **Fiabilit√©** : Gestion des erreurs et retries
- **√âvolutivit√©** : Capacit√© √† g√©rer un grand volume de notifications

## üîÑ Extensibilit√©

Le syst√®me est con√ßu pour √™tre facilement extensible :

1. **Ajouter un nouveau canal** :
   ```python
   class SlackMixin(metaclass=ChannelMeta):
       def send_slack(self, message, channel):
           # Impl√©mentation
   ```

2. **Ajouter un nouveau type d'urgence** :
   ```python
   class EmergencyType(Enum):
       NEW_TYPE = "nouveau_type"
   ```

3. **Ajouter un nouveau descripteur** :
   ```python
   class URLDescriptor:
       def __set__(self, instance, value):
           # Validation URL
   ```

4. **Cr√©er un template personnalis√©** :
   ```python
   class CustomTemplate(metaclass=TemplateMeta):
       required_variables = ['user_name', 'event_name']
       content = "Bonjour {{user_name}}, l'√©v√©nement {{event_name}}..."
   ```

## üéì Valeur P√©dagogique

Ce projet d√©montre :

- L'utilisation pratique de concepts POO avanc√©s
- L'int√©gration de ces concepts dans une application r√©elle
- Les avantages de la programmation orient√©e objet pour la maintenabilit√©
- Les patterns de conception modernes en Python
- L'architecture d'une application web compl√®te avec API et authentification
- L'utilisation de syst√®mes de files d'attente pour le traitement asynchrone

## üìù Notes Importantes

- Les envois de notifications sont **simul√©s** (pas d'int√©gration r√©elle SMS/Email)
- La base de donn√©es peut √™tre PostgreSQL ou SQLite en d√©veloppement
- L'application utilise Flask en mode debug (√† ne pas utiliser en production)
- Les descripteurs sont utilis√©s via des fonctions de validation compatibles avec SQLAlchemy
- L'API FastAPI fournit une documentation interactive et des validations automatiques

## ü§ù Auteur

Projet √©tudiant - Syst√®me de Notification FlashNotify  
Framework : Flask + FastAPI + PostgreSQL  
Concepts : POO Avanc√©e (D√©corateurs, Descripteurs, M√©taclasses), Authentification, Files d'attente, API moderne

---

**Note** : Ce projet est con√ßu √† des fins p√©dagogiques pour d√©montrer l'utilisation de concepts POO avanc√©s en Python dans un contexte d'application web r√©elle avec des fonctionnalit√©s modernes.
